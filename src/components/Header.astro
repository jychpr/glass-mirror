---
import ThemeIcon from './ThemeIcon.astro';

// 1. PATH LOGIC
// We must explicitly list EVERY path that belongs to the "Fun Universe"
const pathname = Astro.url.pathname;
const isFun = pathname.includes('/fun') || 
              pathname.includes('/gaming') || 
              pathname.includes('/content'); // Added this!

// 2. SWITCH LOGIC
const switchTarget = isFun ? '/glass-mirror/' : '/glass-mirror/fun';
const switchLabel = isFun ? "Switch to Pro" : "Switch to Fun";

// 3. TAGLINE LOGIC
const tagline = isFun ? "You found my other side!" : "Hello World!";
---

<header>
    <div class="header-content">
        <div class="brand">
            <a href={isFun ? "/glass-mirror/fun" : "/glass-mirror/"} class="logo" id="logo-text">
                {isFun ? "7Akihito" : "jychpr"}
            </a>
            <span class="tagline fade-in">{tagline}</span>
        </div>

        <div class="controls">
            <ThemeIcon />
            <a href={switchTarget} class="switch-btn" aria-label={switchLabel} title="Switch Personality">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M7 10h14l-4-4"/>
                    <path d="M17 14H3l4 4"/>
                </svg>
            </a>
        </div>
    </div>

    <nav>
        {isFun ? (
            /* === FUN MENU === */
            <div class="nav-links">
                <a href="/glass-mirror/fun">Home</a>
                <a href="/glass-mirror/gaming">Gaming</a>
                <a href="/glass-mirror/content">Contents</a>
                <a href="/glass-mirror/fun-blog">Random Blogs</a>
            </div>
        ) : (
            /* === PRO MENU === */
            <div class="nav-links">
                <a href="/glass-mirror/">Home</a>
                <a href="/glass-mirror/projects">Projects</a>
                <a href="/glass-mirror/blog">Blog</a> 
                <a href="/glass-mirror/tils">TILs</a>
                <a href="/glass-mirror/cv" target="_blank">Resume</a>
            </div>
        )}
    </nav>
</header>

<script is:inline define:vars={{ isFun }}>
    if (isFun) {
        const names = ['7Akihito', 'Akihito', 'kXatze', 'FriendzoneD'];
        const logo = document.getElementById('logo-text');

        if (logo) {
            // 1. RECOVER STATE
            // Check if we have a saved index in the browser's Session Storage
            let storedIndex = sessionStorage.getItem('gamerTagIndex');
            let index = storedIndex ? parseInt(storedIndex) : 0;

            // Safety check: ensure index is valid (in case you changed the list of names)
            if (index >= names.length) index = 0;

            // 2. SET INITIAL STATE IMMEDIATELY
            // This prevents it from flashing "7Akihito" before switching to the correct name
            logo.innerText = names[index];

            // 3. START THE LOOP
            setInterval(() => {
                // Fade Out
                logo.style.opacity = '0';
                
                setTimeout(() => {
                    // Update Index
                    index = (index + 1) % names.length;
                    
                    // Update Text
                    logo.innerText = names[index];
                    
                    // Fade In
                    logo.style.opacity = '1';
                    
                    // 4. SAVE STATE
                    // Save the new index so the next page knows where we left off
                    sessionStorage.setItem('gamerTagIndex', index);
                }, 500); 
                
            }, 3000); 
        }
    }
</script>

<style>
    header {
        margin-bottom: 2rem;
        padding-top: 1rem;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .brand {
        display: flex;
        flex-direction: column;
        line-height: 1.2;
    }

    .logo {
        font-family: 'Courier New', Courier, monospace;
        font-size: 1.8rem;
        font-weight: 900;
        text-decoration: none;
        color: var(--text-color);
        letter-spacing: -1px;
        transition: opacity 0.5s ease-in-out; /* Makes the fade effect smooth */
        min-width: 150px; /* Prevents layout jumping when name length changes */
        display: inline-block;
    }

    .tagline {
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.85rem;
        color: var(--secondary-text);
        animation: fadeIn 1s ease-in;
    }

    .controls {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .switch-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        color: var(--text-color);
        transition: background-color 0.2s, transform 0.2s;
        border: 1px solid transparent;
    }

    .switch-btn:hover {
        background-color: var(--secondary-text-bg);
        transform: rotate(180deg);
        border: 1px solid var(--border-color);
    }

    .nav-links {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
    }

    .nav-links a {
        text-decoration: none;
        color: var(--text-color);
        font-size: 1rem;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: border-color 0.2s;
    }

    .nav-links a:hover {
        border-bottom: 2px solid var(--text-color);
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @media (max-width: 500px) {
        .logo { font-size: 1.5rem; }
        .nav-links { gap: 1rem; font-size: 0.9rem; }
    }
</style>